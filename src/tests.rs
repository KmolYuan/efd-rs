#![doc(hidden)]

/// Epsilon for curve difference.
pub const EPS: f64 = 1e-14;

#[test]
fn efd2d() {
    use crate::*;
    let path = closed_curve(PATH);
    let efd = Efd2::from_curve(&path).unwrap();
    // Test transformation
    let trans = efd.as_trans();
    assert!((trans.trans()[0] - -1.248409055632365).abs() < f64::EPSILON);
    assert!((trans.trans()[1] - 55.26080122817753).abs() < f64::EPSILON);
    assert!((trans.rot() - -0.9284546917601232).abs() < f64::EPSILON);
    assert!((trans.scale() - 48.16765830752243).abs() < f64::EPSILON);
    assert_eq!(efd.harmonic(), 6);
    // Test normalized
    let norm = efd.generate_norm(NORM.len());
    assert!(curve_diff(&norm, NORM) < EPS);
    // Test reconstruction
    let target = efd.generate(TARGET.len());
    assert!(curve_diff(&target, TARGET) < EPS);
}

#[test]
fn efd3d() {
    use crate::*;
    let efd = Efd3::from_curve(PATH3D).unwrap();
    // Test transformation
    let trans = efd.as_trans();
    assert!((trans.trans()[0] - 0.7235610013167717).abs() < f64::EPSILON);
    assert!((trans.trans()[1] - 0.07958760290516126).abs() < f64::EPSILON);
    assert!((trans.trans()[2] - 0.4985879704597386).abs() < f64::EPSILON);
    assert!((trans.rot()[0] - -0.000694374255030466).abs() < f64::EPSILON);
    assert!((trans.rot()[1] - -0.09601297385642525).abs() < f64::EPSILON);
    assert!((trans.rot()[2] - 0.014452811360283688).abs() < f64::EPSILON);
    assert!((trans.scale() - 0.5393843455817737).abs() < f64::EPSILON);
    assert_eq!(efd.harmonic(), 5);
    // Test normalized
    let norm = efd.generate_norm(NORM3D.len());
    assert!(curve_diff(&norm, NORM3D) < EPS);
    // Test reconstruction
    let target = efd.generate(NORM3D.len());
    assert!(curve_diff(&target, TARGET3D) < EPS);
}

pub const PATH: &[[f64; 2]] = &[
    [14.928108089437242, 90.01002059789568],
    [-3.25371009238094, 85.46456605244113],
    [-16.763462931659024, 76.52439024390245],
    [-39.6173464560173, 57.055475143350215],
    [-49.46583130450215, 35.085778173653246],
    [-27.739072687756586, 14.939024390243903],
    [-2.117346456017304, 19.17668726456234],
    [17.958411119740273, 37.7372933251684],
    [26.291744453073605, 57.81305090092597],
    [43.71598687731603, 68.41911150698658],
    [47.12507778640693, 80.5403236281987],
    [38.41295657428572, 90.38880847668355],
    [27.80689596822512, 91.1463842342593],
];
pub const NORM: &[[f64; 2]] = &[
    [0.05553234647386943, 1.119379152671337],
    [-0.19246492442111932, 0.9910207666952372],
    [-0.3466236207064233, 0.7433455516363754],
    [-0.4662127118631491, 0.4912450590109462],
    [-0.5404258318025645, 0.21253057838553358],
    [-0.5402447537989888, -0.08088496699201134],
    [-0.5234770691714837, -0.35699414927505113],
    [-0.483330568432713, -0.6467599401741159],
    [-0.3595326487685509, -0.9080511096122624],
    [-0.14947774345139578, -1.0284506874180428],
    [0.12263773651284177, -0.9974323951564845],
    [0.3764679704172556, -0.8623052545037516],
    [0.5140999552626939, -0.6347643368252188],
    [0.5670235417766133, -0.35164920002427524],
    [0.5674017234826676, -0.06800914369245911],
    [0.45931628321452417, 0.19828936299781613],
    [0.3348867313490356, 0.4527171824458201],
    [0.32487721086570215, 0.7264030988252986],
    [0.27954637306118696, 1.0003704310053017],
    [0.0555323464738718, 1.1193791526713373],
];
pub const TARGET: &[[f64; 2]] = &[
    [43.52580541936114, 85.41974003908122],
    [31.41914569934586, 91.2805058483037],
    [17.418517196895017, 90.07914804660189],
    [4.2447532534628545, 87.41682783854023],
    [-8.646084287386033, 82.23649438254617],
    [-19.957195505252518, 73.7627420984368],
    [-30.122220256970994, 65.14867465329937],
    [-40.13933107431942, 55.23886845955356],
    [-46.64440712361967, 42.92448766942674],
    [-45.226608554249765, 31.348934230012294],
    [-36.17817108831738, 21.749151088169825],
    [-23.642141300790406, 15.858740317938064],
    [-10.894937602526898, 17.11650068817552],
    [1.5512941624695515, 23.24490544911555],
    [12.501526069295421, 31.415007924947],
    [19.653120825390832, 43.267887138455805],
    [25.87526755420776, 55.40858035781829],
    [36.1418456145505, 63.692076052934084],
    [45.40004894143899, 73.34595105201664],
    [43.52580541936122, 85.41974003908112],
];
#[rustfmt::skip]
pub const PATH3D: &[[f64; 3]] = &[
    [0.6999100262927096,0.43028119112952473,0.5700737247541725],
    [0.6296590344074013,0.4512760872295425,0.6323601770225047],
    [0.5638138739696974,0.46183051089148464,0.6847090584540213],
    [0.5058369206546075,0.4615280764519245,0.7287803814245077],
    [0.45702863707701546,0.4510622388540364,0.7665948614304103],
    [0.41723197726966244,0.4317766784472379,0.799678921250722],
    [0.3856541747672426,0.40523683682222406,0.8288871838597307],
    [0.3614034251971859,0.3729768425814701,0.8545617819407205],
    [0.3437381466626122,0.33639334903869056,0.8767460300745514],
    [0.3321447389761846,0.29671906154191235,0.8953422088163436],
    [0.3263372629749841,0.25502826620566654,0.9102002934684913],
    [0.32622858809088523,0.21225076122841705,0.9211539082423659],
    [0.3318929803861661,0.16918542545203516,0.928021196624841],
    [0.34352480290022414,0.1265118028240236,0.9305834049340109],
    [0.36139084538662236,0.08480105307198857,0.9285501808026447],
    [0.38577056486989364,0.04452862638492877,0.9215195454857344],
    [0.41687739559371884,0.0060909757379047635,0.9089423177834546],
    [0.45475516434546037,-0.030172412132808968,0.8901052556002697],
    [0.49914754370187137,-0.06395289690096129,0.8641537806399759],
    [0.5493470560271839,-0.09494849409160033,0.8301822664355119],
    [0.6040449685807827,-0.1228552958162816,0.7874238072487618],
    [0.6612249903953387,-0.14739768525858138,0.7355647044666407],
    [0.7181712990997067,-0.1684251622294386,0.6751762361616609],
    [0.7716940290779204,-0.18608109658863914,0.6081629312757029],
    [0.8186957920221034,-0.20095221972437277,0.5379176568148215],
    [0.8570911228971989,-0.21393997152327254,0.46864111603170266],
    [0.88661962597743,-0.2256744734813517,0.403703691896119],
    [0.9087058112647335,-0.2359493070484034,0.3443568978212587],
    [0.9253987983439792,-0.24384980367577586,0.29012813939844717],
    [0.9384640530551117,-0.24830445184260166,0.24006274246229356],
    [0.9491216566898215,-0.2484529388271337,0.19349216519158882],
    [0.9581400770939057,-0.2437369857356437,0.1501994489037393],
    [0.9659871776934699,-0.2338686278496317,0.11033692690815355],
    [0.9729414021915203,-0.21877677851516128,0.07430847249221559],
    [0.979158591144934,-0.1985626427303512,0.04267704651223003],
    [0.984708076435491,-0.17346680001041803,0.0161019718314504],
    [0.9895891445905367,-0.1438444290548901,-0.004701610196814504],
    [0.9937341248474196,-0.11014503640716575,-0.01898841932855333],
    [0.997000753888979,-0.07289400668205587,-0.02599924103976281],
    [0.9991540450179144,-0.03267407497300495,-0.024971967263275538],
    [0.9998362404365794,0.009894685600921771,-0.015152145277328999],
    [0.9985225360959517,0.05417737861443478,0.004190054292864898],
    [0.9944609178696164,0.09954962956012486,0.03372468064136638],
    [0.9865989401537969,0.14542428454053347,0.07398857177482451],
    [0.9735136458469561,0.19127348741773503,0.12524230260109778],
    [0.9533914378420906,0.2366305939786505,0.18721839718014333],
    [0.9241589851285424,0.2810406966408692,0.25873982499375203],
    [0.8839235581077262,0.32391579444519214,0.33727985639690555],
    [0.8318395864591331,0.36427712952733915,0.4187422540212782],
    [0.7691918202384619,0.4004903064827955,0.49794724428553494],
];
#[rustfmt::skip]
pub const NORM3D: &[[f64; 3]] = &[
    [-0.6277586381512993, 0.2867471722098932, 0.7960958533933429],
    [-0.6174580007834409, 0.17645672656184802, 0.8210016422823143],
    [-0.5886162369436961, 0.0690759207943792, 0.827578232012296],
    [-0.5435596354618473, -0.029736335423174675, 0.8165550088058278],
    [-0.48550521765383176, -0.11654008656467854, 0.7901402769536499],
    [-0.4181554189015915, -0.19038665659194448, 0.751221993494235],
    [-0.3452516319609935, -0.25238205543425896, 0.702497247995994],
    [-0.27016564653655234, -0.3047542593417435, 0.6458506764471937],
    [-0.19560436929263314, -0.34980309171654267, 0.5821831535437],
    [-0.1234797047011997, -0.3891280365908386, 0.5116967450556004],
    [-0.05495598766674107, -0.4233910463969606, 0.43445135625916925],
    [0.009358084169389443, -0.45263424049530226, 0.3509018432824415],
    [0.06914397490689511, -0.4769321658356508, 0.26214591113443425],
    [0.12412309785193067, -0.49701284938502277, 0.16975403988768725],
    [0.1739015376315477, -0.5144919354235368, 0.07525393983680789],
    [0.2179549243845063, -0.5315285148037462, -0.020481924997468724],
    [0.25574927207678216, -0.5499660647163741, -0.11762366083234076],
    [0.2869452489783063, -0.5702653011072698, -0.21728986920164564],
    [0.3116024161779858, -0.5906674590699353, -0.3209013270227439],
    [0.33029741520351363, -0.6069878308144202, -0.42914631698786465],
    [0.3440974288647545, -0.6132372031156793, -0.5409117870576151],
    [0.35437871179389085, -0.6029744034801056, -0.6525999460865292],
    [0.36253332443496666, -0.5710156835176139, -0.7581560573977739],
    [0.36964717314075296, -0.5149717710651278, -0.8499067857465121],
    [0.3762451904661671, -0.4361126062557431, -0.9200287537356685],
    [0.38218035939193873, -0.33926649112556606, -0.962236475012639],
    [0.38669857919971407, -0.23177206681659424, -0.9731844003705776],
    [0.38865612300643587, -0.12180682764293688, -0.9531572032049679],
    [0.38681920505549056, -0.0166064998009446, -0.9058493894909172],
    [0.38015162210464215, 0.07889927666073922, -0.8373290326652507],
    [0.3680039942811054, 0.1626758625089417, -0.7545358277585447],
    [0.35015363892754175, 0.2353151672606703, -0.6637908675316907],
    [0.3266951419635582, 0.29911131386799417, -0.5697533824217567],
    [0.29783106328213765, 0.35686982651871646, -0.47507028423725794],
    [0.2636439541205111, 0.4108713027945892, -0.38070348776140384],
    [0.2239355035653374, 0.4622872615755252, -0.28668711509928985],
    [0.17819599189746368, 0.5111282477851558, -0.19294652344688562],
    [0.12572589071083098, 0.5565854386421607, -0.09984168308003566],
    [0.06588527742488379, 0.5974944392701124, -0.008257030674367227],
    [-0.0015901104433764216, 0.6326508506273358, 0.08072254423923185],
    [-0.07628502377108656, 0.6608309246715316, 0.16632538551277662],
    [-0.15688752896736344, 0.6805552273259706, 0.24849488148962479],
    [-0.24111067335841804, 0.6897926642609146, 0.32793598099939575],
    [-0.3257734927455085, 0.6858630390301623, 0.40572874268137005],
    [-0.40703038856457974, 0.6657286504268609, 0.482632980349542],
    [-0.4807137326683148, 0.6266956826523665, 0.5583601560783806],
    [-0.5427406736056678, 0.567346112760153, 0.6311265199818218],
    [-0.5895305899195866, 0.48837796886836193, 0.6977077114542604],
    [-0.6183814429152792, 0.3930124054573378, 0.7540263086506872],
    [-0.6277586381512994, 0.28674717220988954, 0.7960958533933439],
];
#[rustfmt::skip]
pub const TARGET3D: &[[f64; 3]] = &[
    [0.3431627132904307, 0.22907064558719475, 0.8934445364144044],
    [0.34826050405450903, 0.16965851799498718, 0.9073902001761935],
    [0.3642371835117792, 0.11196634399289937, 0.9124525640250796],
    [0.38976227203027936, 0.059027811651004555, 0.9089008371170868],
    [0.4229678509844006, 0.012672401103926659, 0.8977530286031894],
    [0.4617095973232876, -0.026618045221882686, 0.8803678819802165],
    [0.5038480866314816, -0.059470066528057614, 0.8580004155904786],
    [0.5474930301659132, -0.08711213951288804, 0.8314889713219596],
    [0.591162503852768, -0.11080596420479885, 0.8011781164533234],
    [0.6338320758169457, -0.13142909842053963, 0.7670780749411165],
    [0.6748787186007367, -0.14934760883382037, 0.7291610508555192],
    [0.713952463468326, -0.1645891043429682, 0.6876397973815498],
    [0.7508261242373516, -0.17719667113218995, 0.6430872291277342],
    [0.7852745854359169, -0.18756570198993272, 0.5963324029519926],
    [0.8170199170533199, -0.19657118587258388, 0.5481757800746463],
    [0.8457522539231815, -0.20538197587998047, 0.4990594770247981],
    [0.8712080291085204, -0.2149963916363487, 0.44886523950116425],
    [0.8932664903528749, -0.22566512633691832, 0.3969751158438783],
    [0.9120194316802319, -0.23643863627641254, 0.3426287150899381],
    [0.9277795386089815, -0.245055258676235, 0.2854847553730528],
    [0.9410156947803827, -0.24827697495302187, 0.2261937837415458],
    [0.9522307184495129, -0.24262054016222256, 0.16675621670013596],
    [0.9618186254072691, -0.2252816672190759, 0.11049289080936203],
    [0.9699470629522149, -0.19496618844945163, 0.06157887923353317],
    [0.9765031579757065, -0.15235786207922422, 0.024242169916112166],
    [0.981120438000368, -0.10006421258582618, 0.001851638322303062],
    [0.9832780194718198, -0.042050276219271376, -0.00383274767607239],
    [0.9824400722642359, 0.017264823528998476, 0.006980079185515797],
    [0.9781914279492385, 0.07397045787203553, 0.03224543926287454],
    [0.970327828431021, 0.12540215379729777, 0.0686536415491284],
    [0.9588752859537956, 0.17046012093715973, 0.11244594414897136],
    [0.9440365151390274, 0.20946422157497305, 0.16021681731988263],
    [0.9260854139336212, 0.24365421231452802, 0.20946875598963755],
    [0.9052458235727445, 0.27454575057695224, 0.258790061400632],
    [0.8815941040615801, 0.3033698265725385, 0.3076676998949093],
    [0.8550164674320644, 0.33075674764397256, 0.35607266022889306],
    [0.8252353322179437, 0.356708217998011, 0.4040186574178286],
    [0.7919000502638759, 0.3807827227848701, 0.45127655349863144],
    [0.7547218507877533, 0.40234763505948673, 0.49733883919403216],
    [0.7136243093860424, 0.4207517421391969, 0.54160982177769],
    [0.6688797467532066, 0.43533855173278313, 0.5836971271642858],
    [0.6212068734847063, 0.4453203640079097, 0.6236387500439277],
    [0.5718127348769203, 0.4496192347806218, 0.6619321892152584],
    [0.5223699613307071, 0.44681393784968937, 0.699322809787539],
    [0.47492732161026785, 0.43529571112754056, 0.7364185378696766],
    [0.43175800433102113, 0.4136441493006278, 0.7732809629716619],
    [0.3951571017644095, 0.38112681798368453, 0.8091640360538653],
    [0.36720815925000755, 0.33814916927597255, 0.8425214858483245],
    [0.3495475925590959, 0.2864709496976942, 0.871302661809804],
    [0.3431627132904306, 0.22907064558719276, 0.893444536414405],
];
