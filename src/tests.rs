#![doc(hidden)]

/// Epsilon for curve difference.
pub const EPS: f64 = 2e-14;

#[test]
fn efd2d() {
    use crate::*;
    let efd = Efd2::from_curve(closed_curve(PATH)).unwrap();
    // Test transformation
    let trans = efd.as_trans();
    assert!((trans.trans()[0] - -1.248409055632365).abs() < f64::EPSILON);
    assert!((trans.trans()[1] - 55.26080122817753).abs() < f64::EPSILON);
    assert!((trans.rot() - -0.9284546917601232).abs() < f64::EPSILON);
    assert!((trans.scale() - 48.16765830752243).abs() < f64::EPSILON);
    assert_eq!(efd.harmonic(), 6);
    // Test normalized
    let norm = efd.generate_norm(NORM.len());
    assert!(curve_diff(&norm, NORM) < EPS);
    // Test reconstruction
    let target = efd.generate(TARGET.len());
    assert!(curve_diff(&target, TARGET) < EPS);
}

#[test]
fn efd3d() {
    use crate::*;
    let efd = Efd3::from_curve(closed_curve(PATH3D)).unwrap();
    // Test transformation
    let trans = efd.as_trans();
    assert!((trans.trans()[0] - 0.7239345388499508).abs() < f64::EPSILON);
    assert!((trans.trans()[1] - 0.09100107896533066).abs() < f64::EPSILON);
    assert!((trans.trans()[2] - 0.49979194975846675).abs() < f64::EPSILON);
    assert!((trans.rot()[0] - -0.0006960922473287155).abs() < f64::EPSILON);
    assert!((trans.rot()[1] - -0.10402244066236487).abs() < f64::EPSILON);
    assert!((trans.rot()[2] - 0.013371232475522351).abs() < f64::EPSILON);
    assert!((trans.scale() - 0.5629099155595344).abs() < f64::EPSILON);
    assert_eq!(efd.harmonic(), 5);
    // Test normalized
    let norm = efd.generate_norm(NORM3D.len());
    assert!(curve_diff(&norm, NORM3D) < EPS);
    // Test reconstruction
    let target = efd.generate(NORM3D.len());
    assert!(curve_diff(&target, TARGET3D) < EPS);
}

pub const PATH: &[[f64; 2]] = &[
    [14.928108089437242, 90.01002059789568],
    [-3.25371009238094, 85.46456605244113],
    [-16.763462931659024, 76.52439024390245],
    [-39.6173464560173, 57.055475143350215],
    [-49.46583130450215, 35.085778173653246],
    [-27.739072687756586, 14.939024390243903],
    [-2.117346456017304, 19.17668726456234],
    [17.958411119740273, 37.7372933251684],
    [26.291744453073605, 57.81305090092597],
    [43.71598687731603, 68.41911150698658],
    [47.12507778640693, 80.5403236281987],
    [38.41295657428572, 90.38880847668355],
    [27.80689596822512, 91.1463842342593],
];
pub const NORM: &[[f64; 2]] = &[
    [0.05553234647386943, 1.119379152671337],
    [-0.19246492442111932, 0.9910207666952372],
    [-0.3466236207064233, 0.7433455516363754],
    [-0.4662127118631491, 0.4912450590109462],
    [-0.5404258318025645, 0.21253057838553358],
    [-0.5402447537989888, -0.08088496699201134],
    [-0.5234770691714837, -0.35699414927505113],
    [-0.483330568432713, -0.6467599401741159],
    [-0.3595326487685509, -0.9080511096122624],
    [-0.14947774345139578, -1.0284506874180428],
    [0.12263773651284177, -0.9974323951564845],
    [0.3764679704172556, -0.8623052545037516],
    [0.5140999552626939, -0.6347643368252188],
    [0.5670235417766133, -0.35164920002427524],
    [0.5674017234826676, -0.06800914369245911],
    [0.45931628321452417, 0.19828936299781613],
    [0.3348867313490356, 0.4527171824458201],
    [0.32487721086570215, 0.7264030988252986],
    [0.27954637306118696, 1.0003704310053017],
    [0.0555323464738718, 1.1193791526713373],
];
pub const TARGET: &[[f64; 2]] = &[
    [43.52580541936114, 85.41974003908122],
    [31.41914569934586, 91.2805058483037],
    [17.418517196895017, 90.07914804660189],
    [4.2447532534628545, 87.41682783854023],
    [-8.646084287386033, 82.23649438254617],
    [-19.957195505252518, 73.7627420984368],
    [-30.122220256970994, 65.14867465329937],
    [-40.13933107431942, 55.23886845955356],
    [-46.64440712361967, 42.92448766942674],
    [-45.226608554249765, 31.348934230012294],
    [-36.17817108831738, 21.749151088169825],
    [-23.642141300790406, 15.858740317938064],
    [-10.894937602526898, 17.11650068817552],
    [1.5512941624695515, 23.24490544911555],
    [12.501526069295421, 31.415007924947],
    [19.653120825390832, 43.267887138455805],
    [25.87526755420776, 55.40858035781829],
    [36.1418456145505, 63.692076052934084],
    [45.40004894143899, 73.34595105201664],
    [43.52580541936122, 85.41974003908112],
];
#[rustfmt::skip]
pub const PATH3D: &[[f64; 3]] = &[
    [0.6999100262927096,0.43028119112952473,0.5700737247541725],
    [0.6296590344074013,0.4512760872295425,0.6323601770225047],
    [0.5638138739696974,0.46183051089148464,0.6847090584540213],
    [0.5058369206546075,0.4615280764519245,0.7287803814245077],
    [0.45702863707701546,0.4510622388540364,0.7665948614304103],
    [0.41723197726966244,0.4317766784472379,0.799678921250722],
    [0.3856541747672426,0.40523683682222406,0.8288871838597307],
    [0.3614034251971859,0.3729768425814701,0.8545617819407205],
    [0.3437381466626122,0.33639334903869056,0.8767460300745514],
    [0.3321447389761846,0.29671906154191235,0.8953422088163436],
    [0.3263372629749841,0.25502826620566654,0.9102002934684913],
    [0.32622858809088523,0.21225076122841705,0.9211539082423659],
    [0.3318929803861661,0.16918542545203516,0.928021196624841],
    [0.34352480290022414,0.1265118028240236,0.9305834049340109],
    [0.36139084538662236,0.08480105307198857,0.9285501808026447],
    [0.38577056486989364,0.04452862638492877,0.9215195454857344],
    [0.41687739559371884,0.0060909757379047635,0.9089423177834546],
    [0.45475516434546037,-0.030172412132808968,0.8901052556002697],
    [0.49914754370187137,-0.06395289690096129,0.8641537806399759],
    [0.5493470560271839,-0.09494849409160033,0.8301822664355119],
    [0.6040449685807827,-0.1228552958162816,0.7874238072487618],
    [0.6612249903953387,-0.14739768525858138,0.7355647044666407],
    [0.7181712990997067,-0.1684251622294386,0.6751762361616609],
    [0.7716940290779204,-0.18608109658863914,0.6081629312757029],
    [0.8186957920221034,-0.20095221972437277,0.5379176568148215],
    [0.8570911228971989,-0.21393997152327254,0.46864111603170266],
    [0.88661962597743,-0.2256744734813517,0.403703691896119],
    [0.9087058112647335,-0.2359493070484034,0.3443568978212587],
    [0.9253987983439792,-0.24384980367577586,0.29012813939844717],
    [0.9384640530551117,-0.24830445184260166,0.24006274246229356],
    [0.9491216566898215,-0.2484529388271337,0.19349216519158882],
    [0.9581400770939057,-0.2437369857356437,0.1501994489037393],
    [0.9659871776934699,-0.2338686278496317,0.11033692690815355],
    [0.9729414021915203,-0.21877677851516128,0.07430847249221559],
    [0.979158591144934,-0.1985626427303512,0.04267704651223003],
    [0.984708076435491,-0.17346680001041803,0.0161019718314504],
    [0.9895891445905367,-0.1438444290548901,-0.004701610196814504],
    [0.9937341248474196,-0.11014503640716575,-0.01898841932855333],
    [0.997000753888979,-0.07289400668205587,-0.02599924103976281],
    [0.9991540450179144,-0.03267407497300495,-0.024971967263275538],
    [0.9998362404365794,0.009894685600921771,-0.015152145277328999],
    [0.9985225360959517,0.05417737861443478,0.004190054292864898],
    [0.9944609178696164,0.09954962956012486,0.03372468064136638],
    [0.9865989401537969,0.14542428454053347,0.07398857177482451],
    [0.9735136458469561,0.19127348741773503,0.12524230260109778],
    [0.9533914378420906,0.2366305939786505,0.18721839718014333],
    [0.9241589851285424,0.2810406966408692,0.25873982499375203],
    [0.8839235581077262,0.32391579444519214,0.33727985639690555],
    [0.8318395864591331,0.36427712952733915,0.4187422540212782],
    [0.7691918202384619,0.4004903064827955,0.49794724428553494],
];
#[rustfmt::skip]
pub const NORM3D: &[[f64; 3]] = &[
    [-0.6276654107528166, 0.3151341900212319, 0.7922485520451517],
    [-0.6234588957023178, 0.2052754252862323, 0.8202898983116729],
    [-0.5993626441912716, 0.09628580124057619, 0.8299794180234278],
    [-0.557477471089555, -0.005497579482231238, 0.8216851129853556],
    [-0.5011257583626814, -0.09600260832372393, 0.7972744417966081],
    [-0.4343201991318544, -0.1737695382855751, 0.7593629212042561],
    [-0.36116635403072417, -0.2395229748237914, 0.7104979297769685],
    [-0.2853340428422678, -0.2952132060452573, 0.6525817229795167],
    [-0.20970847557638342, -0.3429440897090526, 0.5867139551810335],
    [-0.13627726731569473, -0.3842068657282157, 0.5134433091578037],
    [-0.06624095169766386, -0.4196744072248691, 0.43324167320516466],
    [-0.0002735519318758581, -0.4495488238952541, 0.34692721177596836],
    [0.06117520000829419, -0.47420591678224033, 0.25580121823399493],
    [0.1176434456704646, -0.4947464793436203, 0.1614109857914449],
    [0.16855922192656195, -0.513103368468695, 0.06504337526377858],
    [0.213297942210535, -0.531550648025267, -0.03279326515364313],
    [0.2513552794575512, -0.551737313548352, -0.13259797497726317],
    [0.2825558008993918, -0.5736091987405411, -0.2356087097593385],
    [0.3072077820993667, -0.5946858900081042, -0.34302651578133164],
    [0.3261359880788131, -0.6100749435899157, -0.45494928749819363],
    [0.3405678798759464, -0.6133575838037021, -0.5693947065766127],
    [0.35189875184129876, -0.5981586791762864, -0.6818180509615869],
    [0.36140066641331514, -0.5599413895492683, -0.7853986557764272],
    [0.36995641306469584, -0.49745032914979526, -0.8721190160936722],
    [0.37788935279815766, -0.4133160219005554, -0.9343810583668721],
    [0.384928376260876, -0.3136001800832712, -0.9666985481006494],
    [0.39030629177640436, -0.20641077036929215, -0.9669523273955115],
    [0.39295359678205893, -0.10002121717220756, -0.9368202583286471],
    [0.3917285502060898, -0.0010792471149367704, -0.8812550741338127],
    [0.3856231823328991, 0.08656418868389561, -0.807188713098101],
    [0.37390076133466155, 0.16211147631074965, -0.721882463596826],
    [0.3561455959350289, 0.22719104859063383, -0.6314338084157741],
    [0.3322316107960807, 0.2846688872590248, -0.5398642398755192],
    [0.30223455586318715, 0.3373749486898653, -0.44898439498415355],
    [0.26632082791381556, 0.38718696110644035, -0.3589515358384836],
    [0.2246448282827082, 0.4347182439582142, -0.2692045787442336],
    [0.17728033787927924, 0.47958498336256317, -0.17936547696309874],
    [0.12420348616388949, 0.520994110113692, -0.08976125086288333],
    [0.06533752874193065, 0.5582882709846371, -0.001414000861469148],
    [0.0006622555336911805, 0.5911458899791916, 0.08441522618707718],
    [-0.06961871180423312, 0.6193289928644865, 0.16685536806551501],
    [-0.14487281734139468, 0.6421116548093343, 0.2458902157505227],
    [-0.2238318986615774, 0.6577020668257318, 0.32240405355119034],
    [-0.30443475755733096, 0.6630115299508993, 0.3977422574985688],
    [-0.38377602851383574, 0.6540031207613471, 0.4729379783494184],
    [-0.45820985558729416, 0.6266178877729272, 0.5479107912129393],
    [-0.5236307143954615, 0.5780227250721383, 0.620972423997852],
    [-0.5759131247906157, 0.5077572274726717, 0.6888665023740991],
    [-0.6114465788701711, 0.4183496392275469, 0.7473673694248136],
    [-0.6276654107528168, 0.31513419002122833, 0.7922485520451528],
];
#[rustfmt::skip]
pub const TARGET3D: &[[f64; 3]] = &[
    [0.32389095494888576, 0.26337012105449986, 0.906536084597176],
    [0.3254292157929818, 0.20155557770488408, 0.9225241925384449],
    [0.339168243672789, 0.14038628333282613, 0.9293999292947137],
    [0.3638630180805135, 0.0834132696561161, 0.9272440652009968],
    [0.39751397705092384, 0.03290296493693491, 0.9169063494187716],
    [0.43771094270606586, -0.010354055523518521, 0.8996160137705278],
    [0.48201208282883656, -0.04679736969358386, 0.8765595649655322],
    [0.5282663829638503, -0.0775529299566326, 0.848588273182185],
    [0.5748101280233375, -0.10382694061904221, 0.8161499788057018],
    [0.6205097100369374, -0.12647385388324062, 0.7794362768341645],
    [0.6646705050835464, -0.145881574083765, 0.738641453326698],
    [0.7068688749455723, -0.16216922520305288, 0.6941842538551493],
    [0.7467798049558989, -0.1755522044003201, 0.6467670893732835],
    [0.7840625404290698, -0.186654164715719, 0.5972296717847618],
    [0.8183361391376056, -0.19656781715073135, 0.5462597941736874],
    [0.849238257436691, -0.20657801499969386, 0.49410644325312003],
    [0.8765280773403404, -0.21761649274576073, 0.4404613881386543],
    [0.9001793412597187, -0.22965359316214778, 0.3846212632702946],
    [0.9204162598344174, -0.24129041485905706, 0.3259306944317164],
    [0.9376696482168797, -0.2497669846761077, 0.2643811743536183],
    [0.9524627438614605, -0.25146201442417115, 0.20115178087664548],
    [0.9652632951152872, -0.2427785237297398, 0.13886602393064296],
    [0.9763507960246508, -0.22115604235270736, 0.08141515225922075],
    [0.9857414286234467, -0.18588447996341695, 0.033339011798075135],
    [0.9931918024730189, -0.13844499373361407, -0.0010885613273887706],
    [0.9982748543750677, -0.08225364663983029, -0.018809489399659762],
    [1.0004979284905824, -0.021880657813549836, -0.018679008163087762],
    [0.9994223035325809, 0.03800984077366972, -0.0016957850286118958],
    [0.9947480633667597, 0.09366949292345136, 0.029303164435072304],
    [0.9863449269735544, 0.14292590823702117, 0.07037946201592549],
    [0.9742308504084085, 0.18532745651414484, 0.11742500109233706],
    [0.9585173284812238, 0.22178998194540617, 0.16700107063348424],
    [0.9393473827359012, 0.25392725448441394, 0.21684768382460468],
    [0.9168480657670564, 0.28333341607902995, 0.26595444944081686],
    [0.8911076647906035, 0.31106667175811414, 0.3142423156829409],
    [0.8621752298845237, 0.33747317167505386, 0.36203420048486457],
    [0.8300728413251799, 0.36233728733061216, 0.4095462217907796],
    [0.7948121870546347, 0.3852125805433533, 0.45659420553814595],
    [0.7564149666065865, 0.4057288773061578, 0.5026016819327918],
    [0.7149459811504376, 0.4237055155165932, 0.5468615765135032],
    [0.6705719163587986, 0.4390104127563496, 0.5888982046665033],
    [0.6236532694532186, 0.4512397165343962, 0.6287397471179528],
    [0.5748617065327417, 0.45939403794141465, 0.6669561075056412],
    [0.5252956063732582, 0.46174977745624207, 0.7044221976460774],
    [0.47655127481309656, 0.45605605895940987, 0.7418878356131793],
    [0.43070480996504557, 0.4400555848291621, 0.7795226752723936],
    [0.3901744418573333, 0.41218510452131346, 0.8166225796651847],
    [0.35746346545437124, 0.3722176263354313, 0.8516057248676085],
    [0.3348211670538832, 0.3216048725246087, 0.8823163529100491],
    [0.3238909549488856, 0.26337012105449786, 0.9065360845971766],
];
