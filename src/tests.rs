#![doc(hidden)]

#[test]
fn efd2d() {
    use crate::*;
    let path = closed_curve(PATH);
    let efd = Efd2::from_curve(&path).unwrap();
    // Test transformation
    assert!((efd.trans()[0] - -1.248409055632365).abs() < f64::EPSILON);
    assert!((efd.trans()[1] - 55.26080122817753).abs() < f64::EPSILON);
    assert!((efd.rot() - -0.9284546917601232).abs() < f64::EPSILON);
    assert!((efd.scale() - 48.16765830752243).abs() < f64::EPSILON);
    assert_eq!(efd.harmonic(), 6);
    // Test normalized
    let norm = efd.generate_norm(NORM.len());
    assert!(curve_diff(&norm, NORM) < 1e-12);
    // Test reconstruction
    let target = efd.generate(TARGET.len());
    assert!(curve_diff(&target, TARGET) < 1e-12);
}

#[test]
fn efd3d() {
    use crate::*;
    let efd = Efd3::from_curve(PATH3D).unwrap();
    // Test transformation
    assert!((efd.trans()[0] - 0.7235610013167717).abs() < f64::EPSILON);
    assert!((efd.trans()[1] - 0.07958760290516126).abs() < f64::EPSILON);
    assert!((efd.trans()[2] - 0.4985879704597386).abs() < f64::EPSILON);
    assert!((efd.rot()[0] - -0.000694374255030466).abs() < f64::EPSILON);
    assert!((efd.rot()[1] - -0.09601297385642525).abs() < f64::EPSILON);
    assert!((efd.rot()[2] - 0.014452811360283688).abs() < f64::EPSILON);
    assert!((efd.scale() - 0.4398917506743902).abs() < f64::EPSILON);
    assert_eq!(efd.harmonic(), 5);
    // Test normalized
    let norm = efd.generate_norm(NORM3D.len());
    assert!(curve_diff(&norm, NORM3D) < 1e-12);
    // Test reconstruction
    let target = efd.generate(NORM3D.len());
    assert!(curve_diff(&target, TARGET3D) < 1e-12);
}

pub const PATH: &[[f64; 2]] = &[
    [14.928108089437242, 90.01002059789568],
    [-3.25371009238094, 85.46456605244113],
    [-16.763462931659024, 76.52439024390245],
    [-39.6173464560173, 57.055475143350215],
    [-49.46583130450215, 35.085778173653246],
    [-27.739072687756586, 14.939024390243903],
    [-2.117346456017304, 19.17668726456234],
    [17.958411119740273, 37.7372933251684],
    [26.291744453073605, 57.81305090092597],
    [43.71598687731603, 68.41911150698658],
    [47.12507778640693, 80.5403236281987],
    [38.41295657428572, 90.38880847668355],
    [27.80689596822512, 91.1463842342593],
];
pub const NORM: &[[f64; 2]] = &[
    [0.05553234647386943, 1.119379152671337],
    [-0.19246492442111932, 0.9910207666952372],
    [-0.3466236207064233, 0.7433455516363754],
    [-0.4662127118631491, 0.4912450590109462],
    [-0.5404258318025645, 0.21253057838553358],
    [-0.5402447537989888, -0.08088496699201134],
    [-0.5234770691714837, -0.35699414927505113],
    [-0.483330568432713, -0.6467599401741159],
    [-0.3595326487685509, -0.9080511096122624],
    [-0.14947774345139578, -1.0284506874180428],
    [0.12263773651284177, -0.9974323951564845],
    [0.3764679704172556, -0.8623052545037516],
    [0.5140999552626939, -0.6347643368252188],
    [0.5670235417766133, -0.35164920002427524],
    [0.5674017234826676, -0.06800914369245911],
    [0.45931628321452417, 0.19828936299781613],
    [0.3348867313490356, 0.4527171824458201],
    [0.32487721086570215, 0.7264030988252986],
    [0.27954637306118696, 1.0003704310053017],
    [0.0555323464738718, 1.1193791526713373],
];
pub const TARGET: &[[f64; 2]] = &[
    [43.52580541936114, 85.41974003908122],
    [31.41914569934586, 91.2805058483037],
    [17.418517196895017, 90.07914804660189],
    [4.244753253462857, 87.41682783854023],
    [-8.646084287386033, 82.23649438254617],
    [-19.957195505252518, 73.7627420984368],
    [-30.122220256970994, 65.14867465329937],
    [-40.13933107431942, 55.23886845955356],
    [-46.64440712361967, 42.92448766942674],
    [-45.226608554249765, 31.348934230012294],
    [-36.17817108831738, 21.749151088169825],
    [-23.642141300790406, 15.858740317938057],
    [-10.894937602526898, 17.11650068817552],
    [1.5512941624695515, 23.24490544911555],
    [12.501526069295421, 31.415007924947],
    [19.653120825390836, 43.267887138455805],
    [25.87526755420776, 55.40858035781829],
    [36.1418456145505, 63.692076052934084],
    [45.40004894143899, 73.34595105201664],
    [43.52580541936122, 85.41974003908112],
];
#[rustfmt::skip]
pub const PATH3D: &[[f64; 3]] = &[
    [0.6999100262927096,0.43028119112952473,0.5700737247541725],
    [0.6296590344074013,0.4512760872295425,0.6323601770225047],
    [0.5638138739696974,0.46183051089148464,0.6847090584540213],
    [0.5058369206546075,0.4615280764519245,0.7287803814245077],
    [0.45702863707701546,0.4510622388540364,0.7665948614304103],
    [0.41723197726966244,0.4317766784472379,0.799678921250722],
    [0.3856541747672426,0.40523683682222406,0.8288871838597307],
    [0.3614034251971859,0.3729768425814701,0.8545617819407205],
    [0.3437381466626122,0.33639334903869056,0.8767460300745514],
    [0.3321447389761846,0.29671906154191235,0.8953422088163436],
    [0.3263372629749841,0.25502826620566654,0.9102002934684913],
    [0.32622858809088523,0.21225076122841705,0.9211539082423659],
    [0.3318929803861661,0.16918542545203516,0.928021196624841],
    [0.34352480290022414,0.1265118028240236,0.9305834049340109],
    [0.36139084538662236,0.08480105307198857,0.9285501808026447],
    [0.38577056486989364,0.04452862638492877,0.9215195454857344],
    [0.41687739559371884,0.0060909757379047635,0.9089423177834546],
    [0.45475516434546037,-0.030172412132808968,0.8901052556002697],
    [0.49914754370187137,-0.06395289690096129,0.8641537806399759],
    [0.5493470560271839,-0.09494849409160033,0.8301822664355119],
    [0.6040449685807827,-0.1228552958162816,0.7874238072487618],
    [0.6612249903953387,-0.14739768525858138,0.7355647044666407],
    [0.7181712990997067,-0.1684251622294386,0.6751762361616609],
    [0.7716940290779204,-0.18608109658863914,0.6081629312757029],
    [0.8186957920221034,-0.20095221972437277,0.5379176568148215],
    [0.8570911228971989,-0.21393997152327254,0.46864111603170266],
    [0.88661962597743,-0.2256744734813517,0.403703691896119],
    [0.9087058112647335,-0.2359493070484034,0.3443568978212587],
    [0.9253987983439792,-0.24384980367577586,0.29012813939844717],
    [0.9384640530551117,-0.24830445184260166,0.24006274246229356],
    [0.9491216566898215,-0.2484529388271337,0.19349216519158882],
    [0.9581400770939057,-0.2437369857356437,0.1501994489037393],
    [0.9659871776934699,-0.2338686278496317,0.11033692690815355],
    [0.9729414021915203,-0.21877677851516128,0.07430847249221559],
    [0.979158591144934,-0.1985626427303512,0.04267704651223003],
    [0.984708076435491,-0.17346680001041803,0.0161019718314504],
    [0.9895891445905367,-0.1438444290548901,-0.004701610196814504],
    [0.9937341248474196,-0.11014503640716575,-0.01898841932855333],
    [0.997000753888979,-0.07289400668205587,-0.02599924103976281],
    [0.9991540450179144,-0.03267407497300495,-0.024971967263275538],
    [0.9998362404365794,0.009894685600921771,-0.015152145277328999],
    [0.9985225360959517,0.05417737861443478,0.004190054292864898],
    [0.9944609178696164,0.09954962956012486,0.03372468064136638],
    [0.9865989401537969,0.14542428454053347,0.07398857177482451],
    [0.9735136458469561,0.19127348741773503,0.12524230260109778],
    [0.9533914378420906,0.2366305939786505,0.18721839718014333],
    [0.9241589851285424,0.2810406966408692,0.25873982499375203],
    [0.8839235581077262,0.32391579444519214,0.33727985639690555],
    [0.8318395864591331,0.36427712952733915,0.4187422540212782],
    [0.7691918202384619,0.4004903064827955,0.49794724428553494],
];
#[rustfmt::skip]
pub const NORM3D: &[[f64; 3]] = &[
    [-0.7697420597304624, 0.35160226485888935, 0.976152974554817],
    [-0.7571116738748065, 0.21636685806030398, 1.0066918346732],
    [-0.7217466189714697, 0.08469917945952471, 1.014755885754466],
    [-0.6664993326398492, -0.03646195637367511, 1.0012394830797007],
    [-0.5953144465638976, -0.14289856136052337, 0.9688503945551665],
    [-0.5127317951062417, -0.23344739249125102, 0.9211297614159],
    [-0.42333898119440583, -0.3094646116875136, 0.8613846879429017],
    [-0.33127040966871857, -0.3736821081238666, 0.7919260680041132],
    [-0.23984522228955932, -0.4289198681692693, 0.713858531789884],
    [-0.15140774886271308, -0.4771391394412196, 0.6274298473317724],
    [-0.06738566794667307, -0.5191515915811022, 0.532713468992563],
    [0.011474650519967454, -0.5550088703031355, 0.430267130065908],
    [0.08478262572303674, -0.5848023832267271, 0.32143680918637546],
    [0.15219666157368528, -0.6094248189475778, 0.20814819003609275],
    [0.21323374881946253, -0.6308572403780719, 0.09227451305712772],
    [0.2672509181525467, -0.651747071128156, -0.025114428024798657],
    [0.3135934091527423, -0.6743547371698758, -0.1442272132307988],
    [0.35184514167560993, -0.6992451569600338, -0.266435443995477],
    [0.382079148049928, -0.7242617766267525, -0.39348124170804655],
    [0.405002491803424, -0.7442734113517832, -0.5262085615210059],
    [0.4219237260076946, -0.7519362365442172, -0.6632526066520875],
    [0.43453037993100985, -0.7393522463766716, -0.8002018549039283],
    [0.4445293635358087, -0.7001652572454311, -0.9296321384554752],
    [0.45325218823723984, -0.6314456029311989, -1.0421346040988173],
    [0.4613425133041446, -0.5347504525024289, -1.1281164206633514],
    [0.46862007011678486, -0.41600015006655994, -1.1798704808033162],
    [0.4741601990927777, -0.2841931552304556, -1.1932945551252752],
    [0.47656049071797335, -0.149356508538414, -1.1687377030805424],
    [0.474308107522928, -0.020362477845524706, -1.1107300361899088],
    [0.46613248281288966, 0.0967443345852353, -1.0267120754784818],
    [0.45123736310690715, 0.19946910463043713, -0.9251931027340328],
    [0.4293497004580322, 0.2885376170473197, -0.8139238849963352],
    [0.4005854737730534, 0.366762868454458, -0.6986174549748216],
    [0.3651930569647579, 0.43758492297156293, -0.5825193902268347],
    [0.3232736723111321, 0.5038001927438567, -0.46680916678267353],
    [0.27458415589275686, 0.5668451651421743, -0.35152862432061915],
    [0.2184995020423879, 0.6267327700901245, -0.23658623768717046],
    [0.15416196639237242, 0.6824712491700389, -0.1224233934993024],
    [0.08078689175873988, 0.732632850287322, -0.010124566054976664],
    [-0.0019497539555775544, 0.7757407692329447, 0.09897998003241197],
    [-0.09353880258353538, 0.810294476533597, 0.20394405914843233],
    [-0.19237159372111295, 0.8344799268472503, 0.3046982554849374],
    [-0.29564392276698004, 0.8458066427230743, 0.40210695979840305],
    [-0.3994553703792717, 0.8409882338071956, 0.4974945131828484],
    [-0.49909055905508376, 0.816299946282296, 0.591792580476719],
    [-0.5894392466100096, 0.7684386900825992, 0.6846473636378835],
    [-0.6654951419402635, 0.69566572066957, 0.7738716728327043],
    [-0.7228677758942246, 0.5988369427950571, 0.8555118771224158],
    [-0.7582439756949715, 0.48190205612661496, 0.9245683430513796],
    [-0.7697420597304622, 0.35160226485888485, 0.9761529745548185],
];
#[rustfmt::skip]
pub const TARGET3D: &[[f64; 3]] = &[
    [0.34316271329043063, 0.22907064558719478, 0.8934445364144044],
    [0.3482605040545091, 0.1696585179949872, 0.9073902001761937],
    [0.3642371835117792, 0.1119663439928994, 0.9124525640250796],
    [0.3897622720302793, 0.059027811651004555, 0.9089008371170868],
    [0.4229678509844006, 0.012672401103926659, 0.8977530286031894],
    [0.4617095973232876, -0.026618045221882713, 0.8803678819802168],
    [0.5038480866314816, -0.05947006652805764, 0.8580004155904786],
    [0.5474930301659132, -0.08711213951288801, 0.8314889713219598],
    [0.591162503852768, -0.11080596420479882, 0.8011781164533234],
    [0.6338320758169457, -0.13142909842053968, 0.7670780749411165],
    [0.6748787186007367, -0.14934760883382045, 0.7291610508555192],
    [0.713952463468326, -0.16458910434296825, 0.6876397973815498],
    [0.7508261242373517, -0.17719667113219006, 0.6430872291277342],
    [0.7852745854359169, -0.18756570198993283, 0.5963324029519926],
    [0.8170199170533199, -0.19657118587258393, 0.5481757800746463],
    [0.8457522539231815, -0.20538197587998053, 0.4990594770247981],
    [0.8712080291085204, -0.21499639163634876, 0.4488652395011642],
    [0.8932664903528749, -0.22566512633691843, 0.39697511584387835],
    [0.9120194316802318, -0.23643863627641265, 0.34262871508993814],
    [0.9277795386089815, -0.245055258676235, 0.28548475537305273],
    [0.9410156947803827, -0.24827697495302198, 0.2261937837415458],
    [0.952230718449513, -0.24262054016222256, 0.1667562167001359],
    [0.9618186254072691, -0.22528166721907594, 0.11049289080936198],
    [0.9699470629522149, -0.19496618844945163, 0.06157887923353317],
    [0.9765031579757064, -0.15235786207922425, 0.02424216991611211],
    [0.981120438000368, -0.10006421258582618, 0.0018516383223028399],
    [0.9832780194718197, -0.042050276219271404, -0.00383274767607239],
    [0.9824400722642359, 0.017264823528998448, 0.006980079185515686],
    [0.9781914279492385, 0.07397045787203553, 0.03224543926287449],
    [0.970327828431021, 0.12540215379729774, 0.06865364154912829],
    [0.9588752859537957, 0.17046012093715973, 0.11244594414897136],
    [0.9440365151390275, 0.20946422157497305, 0.16021681731988258],
    [0.9260854139336212, 0.24365421231452808, 0.20946875598963755],
    [0.9052458235727445, 0.2745457505769522, 0.258790061400632],
    [0.8815941040615801, 0.3033698265725385, 0.3076676998949093],
    [0.8550164674320645, 0.33075674764397256, 0.35607266022889295],
    [0.8252353322179437, 0.35670821799801106, 0.4040186574178286],
    [0.7919000502638759, 0.38078272278487013, 0.45127655349863144],
    [0.7547218507877533, 0.4023476350594868, 0.49733883919403216],
    [0.7136243093860424, 0.420751742139197, 0.54160982177769],
    [0.6688797467532066, 0.4353385517327832, 0.5836971271642858],
    [0.6212068734847063, 0.4453203640079098, 0.6236387500439278],
    [0.5718127348769204, 0.4496192347806218, 0.6619321892152585],
    [0.5223699613307072, 0.44681393784968937, 0.699322809787539],
    [0.47492732161026785, 0.4352957111275407, 0.7364185378696768],
    [0.43175800433102113, 0.4136441493006279, 0.7732809629716619],
    [0.39515710176440944, 0.38112681798368464, 0.8091640360538653],
    [0.36720815925000766, 0.3381491692759726, 0.8425214858483245],
    [0.349547592559096, 0.28647094969769427, 0.8713026618098041],
    [0.3431627132904307, 0.22907064558719278, 0.893444536414405],
];
